<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Widget CDN Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            border-bottom: 3px solid #25D366;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .test-section {
            margin: 40px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .test-section h2 {
            color: #128C7E;
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
        }

        button {
            background: #25D366;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        button:hover {
            background: #128C7E;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        button.secondary {
            background: #6c757d;
        }

        button.secondary:hover {
            background: #5a6268;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .status {
            padding: 10px 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .test-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .test-card h3 {
            color: #075E54;
            margin-bottom: 15px;
        }

        .test-card p {
            color: #666;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ WhatsApp Widget CDN Test Suite</h1>

        <div class="test-section">
            <h2>üì¶ Test Local Build</h2>
            <p>Test the minified widget from local dist folder:</p>

            <div class="button-group">
                <button onclick="loadLocalWidget()">Load Local Widget</button>
                <button onclick="loadLocalWidgetWithOptions()">Load with Custom Options</button>
                <button class="secondary" onclick="removeWidget()">Remove Widget</button>
            </div>

            <div id="local-status" class="status info">Click a button to load the local widget</div>
        </div>

        <div class="test-section">
            <h2>üåê Test CDN Versions</h2>
            <p>Test different CDN version strategies:</p>

            <div class="test-grid">
                <div class="test-card">
                    <h3>Latest Version</h3>
                    <p>Always gets the newest version</p>
                    <button onclick="loadCDNLatest()">Load @latest</button>
                </div>

                <div class="test-card">
                    <h3>Major Version</h3>
                    <p>Gets latest 1.x.x version</p>
                    <button onclick="loadCDNMajor()">Load @1</button>
                </div>

                <div class="test-card">
                    <h3>Specific Version</h3>
                    <p>Exact version 1.0.0</p>
                    <button onclick="loadCDNSpecific()">Load @1.0.0</button>
                </div>
            </div>

            <div id="cdn-status" class="status info">CDN widget not loaded yet</div>
        </div>

        <div class="test-section">
            <h2>üé® Test Different Configurations</h2>

            <div class="test-grid">
                <div class="test-card">
                    <h3>Bottom Right + Red</h3>
                    <button onclick="loadCustom('bottom-right', '#FF5252', 'Urgent Support!')">Test</button>
                </div>

                <div class="test-card">
                    <h3>Top Left + Blue</h3>
                    <button onclick="loadCustom('top-left', '#2196F3', 'Quick Question?')">Test</button>
                </div>

                <div class="test-card">
                    <h3>Top Right + Purple</h3>
                    <button onclick="loadCustom('top-right', '#9C27B0', 'VIP Support')">Test</button>
                </div>

                <div class="test-card">
                    <h3>Large Size (80px)</h3>
                    <button onclick="loadWithSize(80)">Test Large</button>
                </div>

                <div class="test-card">
                    <h3>Small Size (40px)</h3>
                    <button onclick="loadWithSize(40)">Test Small</button>
                </div>

                <div class="test-card">
                    <h3>With Placeholders</h3>
                    <button onclick="loadWithPlaceholders()">Test Placeholders</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>üìä Console Output</h2>
            <p>Check browser console for detailed logs</p>
            <div class="code-block" id="console-output">
                // Console output will appear here
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const TEST_PHONE = '5511999999999';
        const CDN_BASE = 'https://cdn.jsdelivr.net/gh/plazatechnologies/whatsapp-widget';

        // Override console.log to display in page
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const output = document.getElementById('console-output');
            const timestamp = new Date().toTimeString().split(' ')[0];
            output.innerHTML += `[${timestamp}] ${args.join(' ')}\n`;
        };

        // Helper function to remove existing widget
        function removeWidget() {
            // Remove buttons
            const buttons = document.querySelectorAll('[id^="whatsapp-widget-button"]');
            buttons.forEach(b => b.remove());

            // Remove tooltips
            const tooltips = document.querySelectorAll('.whatsapp-widget-tooltip');
            tooltips.forEach(t => t.remove());

            // Remove scripts
            const scripts = document.querySelectorAll('[data-widget-script]');
            scripts.forEach(s => s.remove());

            // Remove styles
            const styles = document.getElementById('whatsapp-widget-styles');
            if (styles) styles.remove();

            // Reset flag
            window.__whatsappWidgetInitialized = false;

            console.log('‚úÖ Widget removed');
            updateStatus('local-status', 'Widget removed', 'info');
        }

        // Load local widget
        function loadLocalWidget() {
            removeWidget();

            const script = document.createElement('script');
            script.src = `dist/whatsapp-widget.min.js?phone=${TEST_PHONE}&message=Testing local build`;
            script.setAttribute('data-widget-script', 'true');
            script.onerror = () => {
                console.log('‚ùå Failed to load local widget');
                updateStatus('local-status', 'Failed to load local widget. Run npm run build first.', 'error');
            };
            script.onload = () => {
                console.log('‚úÖ Local widget loaded');
                updateStatus('local-status', 'Local widget loaded successfully!', 'success');
            };

            document.body.appendChild(script);
        }

        // Load local widget with options
        function loadLocalWidgetWithOptions() {
            removeWidget();

            const script = document.createElement('script');
            script.src = 'dist/whatsapp-widget.min.js';
            script.setAttribute('data-whatsapp-phone', TEST_PHONE);
            script.setAttribute('data-whatsapp-message', 'Custom message from data attributes');
            script.setAttribute('data-whatsapp-position', 'bottom-right');
            script.setAttribute('data-whatsapp-tooltip', 'Chat with us!');
            script.setAttribute('data-whatsapp-color', '#FF6B6B');
            script.setAttribute('data-widget-script', 'true');

            script.onload = () => {
                console.log('‚úÖ Local widget with options loaded');
                updateStatus('local-status', 'Local widget with custom options loaded!', 'success');
            };

            document.body.appendChild(script);
        }

        // Load CDN versions
        function loadCDNLatest() {
            loadFromCDN('@latest', 'Latest CDN version');
        }

        function loadCDNMajor() {
            loadFromCDN('@1', 'Major version 1.x');
        }

        function loadCDNSpecific() {
            loadFromCDN('@1.0.0', 'Specific version 1.0.0');
        }

        function loadFromCDN(version, description) {
            removeWidget();

            const url = `${CDN_BASE}${version}/dist/whatsapp-widget.min.js`;
            const script = document.createElement('script');
            script.src = `${url}?phone=${TEST_PHONE}&message=Testing ${description}`;
            script.setAttribute('data-widget-script', 'true');

            script.onerror = () => {
                console.log(`‚ùå Failed to load from CDN: ${url}`);
                updateStatus('cdn-status', `Failed to load ${description}. Push to GitHub first.`, 'error');
            };

            script.onload = () => {
                console.log(`‚úÖ Loaded from CDN: ${description}`);
                updateStatus('cdn-status', `${description} loaded successfully!`, 'success');
            };

            document.body.appendChild(script);
        }

        // Load with custom configuration
        function loadCustom(position, color, tooltip) {
            removeWidget();

            const script = document.createElement('script');
            script.src = `dist/whatsapp-widget.min.js?phone=${TEST_PHONE}&position=${position}&color=${encodeURIComponent(color)}&tooltip=${encodeURIComponent(tooltip)}&message=Custom config test`;
            script.setAttribute('data-widget-script', 'true');

            script.onload = () => {
                console.log(`‚úÖ Custom config: ${position}, ${color}, ${tooltip}`);
                updateStatus('local-status', `Custom configuration applied!`, 'success');
            };

            document.body.appendChild(script);
        }

        // Load with different sizes
        function loadWithSize(size) {
            removeWidget();

            const script = document.createElement('script');
            script.src = `dist/whatsapp-widget.min.js?phone=${TEST_PHONE}&size=${size}&message=Size test: ${size}px`;
            script.setAttribute('data-widget-script', 'true');

            script.onload = () => {
                console.log(`‚úÖ Widget size: ${size}px`);
                updateStatus('local-status', `Widget loaded with ${size}px size`, 'success');
            };

            document.body.appendChild(script);
        }

        // Load with placeholders
        function loadWithPlaceholders() {
            removeWidget();

            const script = document.createElement('script');
            script.src = `dist/whatsapp-widget.min.js?phone=${TEST_PHONE}&message=Hi! I'm on {title} at {url}`;
            script.setAttribute('data-widget-script', 'true');

            script.onload = () => {
                console.log('‚úÖ Widget with placeholders loaded');
                updateStatus('local-status', 'Placeholders will be replaced with page info', 'success');
            };

            document.body.appendChild(script);
        }

        // Update status message
        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        // Initial console message
        console.log('WhatsApp Widget CDN Test Suite loaded');
        console.log('Click buttons to test different configurations');
    </script>
</body>
</html>